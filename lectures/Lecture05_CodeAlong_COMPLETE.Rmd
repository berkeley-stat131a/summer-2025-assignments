---
title: "Lecture05_CodeAlong"
output: pdf_document
---

```{r}
library(tidyverse)
```

```{r}
df = read_csv('data/class_survey_simplified.csv')
```

```{r}
df |>
    group_by(language) |>
    summarize(comfort = mean(comfort_coding))
```

## Using functions

## Question: Do people who come from R and Python backgrounds differ in their comfort level with coding?

Put differently, are R-students and Python-students different groups? (In terms of coding comfort)

Null hypothesis:

-   Groups are not different

-   Comfort level is independent of language

Test statistic:

-   abs(mean(comfort level of R coders) - mean(comfort level of Python coders))

1.  State the null hypothesis
2.  State your test statistic.
3.  Write a function that takes a dataframe as its only argument and returns your test statistic.
4.  Call this function once with the original dataset. Confirm that it is consistent with the results you saw in the question above (B1).
5.  Simulate the null hypothesis by randomly shuffling the data in the `sex` column, then computing a test statistic on this new dataset (by calling your function). **Be sure not to overwrite the original dataset when you do this!**
6.  Move this code into a function called `simulate_null_get_test_stat` (or whatever name you think is more intuitive). The function shouldn't need any arguments.
7.  Use `rep` to run this function 1000 times to get a vector of 1000 test statistics, each representing one simulation of the null hypothesis and computing a test statistic. Be sure to save these 1000 numbers to a variable called `null_test_stats`.
8.  What does this vector of numbers represent? Answer this question in simple language, as if you're explaining it to a friend who hasn't taken statistics.
9.  Compute the test statistic on our real, original data, and save it to a variable called `observed_test_stat`
10. Using the results from the two steps above, compute a p-value.
11. Write a sentence that explains, in plain english, how to interpret your p-value. What does your number *literally* mean in terms of men, women, and cat ownership? Note: Your answer should NOT use the words "statistically significant" at all! You're just explaining what this number objectively says, not what meaning you make of it.

```{r}
r_coders = df |>
    filter(language == "R")
py_coders = df |>
    filter(language == "Python")
r_mean = mean(r_coders$comfort_coding)
py_mean = mean(py_coders$comfort_coding)
abs(r_mean - py_mean)
```

```{r}
get_test_stat = function(frame) {
    r_coders = frame |>
        filter(language == "R")
    py_coders = frame |>
        filter(language == "Python")
    r_mean = mean(r_coders$comfort_coding)
    py_mean = mean(py_coders$comfort_coding)
    return(abs(r_mean - py_mean))
}
get_test_stat(df)
```

```{r}
sim_once = function() {
    stat = df |>
        mutate(language = sample(language)) |>
        get_test_stat()
    return(stat)
}
```

```{r}
replicate(10, sim_once())
```

```{r}
observed_stat = get_test_stat(df)
null_dist = replicate(1000, sim_once())
p = mean(null_dist > observed_stat)
```

```{r}
label_text = paste("p =", round(p, 2))
data.frame(stat = null_dist) |>
    ggplot(aes(x=stat)) +
    geom_histogram(binwidth=0.25) +
    geom_vline(xintercept=observed_stat) +
    annotate("label", x = observed_stat, y = 0, label = label_text)
```
